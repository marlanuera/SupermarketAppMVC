<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Reviews - SunnySide Market</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">

<style>
body { 
    background-color: #FFFBEA; 
    font-family: Arial, sans-serif; 
}

nav.navbar { 
    background-color: #2E8B57 !important; 
}

nav .navbar-brand { 
    font-family: 'Pacifico', cursive; 
    font-size: 1.8rem; 
    color: white !important; 
}

nav .nav-link { 
    color: white !important; 
    font-weight: bold; 
}

nav .nav-link:hover { 
    background-color: #FFD54F; 
    color: black !important; 
    border-radius: 5px; 
}

/* Review card */
.review-card { 
    background-color: #FFF5E1; 
    border-radius: 10px; 
    padding: 15px; 
    margin-bottom: 15px; 
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.review-header { 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
}

.rating { 
    color: #FFA500; 
    font-weight: bold; 
}

.btn-delete { 
    background-color: #FF4C4C; 
    border: none; 
    color: white; 
    font-weight: bold; 
}

.btn-delete:hover { 
    background-color: #FF1A1A; 
}

.btn-add { 
    background-color: #28a745; 
    color: white; 
    font-weight: bold; 
}

.btn-add:hover { 
    background-color: #218838; 
}
</style>
</head>
<body>

<!-- ⭐ SAME NAVBAR AS SHOPPING PAGE ⭐ -->
<nav class="navbar navbar-expand-sm navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">SunnySide Market</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleNavbar">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="collapsibleNavbar">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="/shopping">Shopping</a></li>
                <li class="nav-item"><a class="nav-link" href="/cart">View Cart</a></li> 
                <li class="nav-item"><a class="nav-link" href="/reviews">Reviews</a></li>
                <li class="nav-item"><a class="nav-link" href="/logout">Logout</a></li> 
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-4">
  <h2>Product Reviews</h2>

  <!-- Add Review Form -->
  <div class="mb-4">
    <form action="/reviews/add" method="POST" class="row g-2 align-items-end">
      <div class="col-md-4">
        <label for="productId" class="form-label">Product</label>
        <select class="form-select" name="productId" required>
          <option value="">Select product</option>
          <% products.forEach(p => { %>
            <option value="<%= p.id %>"><%= p.productName %></option>
          <% }) %>
        </select>
      </div>

      <div class="col-md-2">
        <label for="rating" class="form-label">Rating</label>
        <select class="form-select" name="rating" required>
          <% for(let i=1;i<=5;i++){ %>
            <option value="<%= i %>"><%= i %> ⭐</option>
          <% } %>
        </select>
      </div>

      <div class="col-md-4">
        <label for="comment" class="form-label">Comment</label>
        <input type="text" class="form-control" name="comment" placeholder="Your review..." required>
      </div>

      <div class="col-md-2">
        <button type="submit" class="btn btn-add w-100">Add Review</button>
      </div>
    </form>
  </div>

  <!-- Reviews List -->
  <% reviews.forEach(r => { %>
    <div class="review-card">
      <div class="review-header">
        <div>
          <strong><%= r.username %></strong> on <em><%= r.productName %></em>
        </div>
        <div class="rating"><%= r.rating %> ⭐</div>
      </div>
      
      <p><%= r.comment %></p>
      <small class="text-muted"><%= new Date(r.createdAt).toLocaleString() %></small>
      
      <% if(user.id === r.userId || user.role === 'admin') { %>
        <form action="/reviews/delete/<%= r.id %>" method="POST" class="mt-2">
          <button type="submit" class="btn-delete">Delete</button>
        </form>
      <% } %>
    </div>
  <% }) %>
</div>

</body>
</html>

